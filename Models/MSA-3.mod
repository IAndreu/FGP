set aa;
param n > 0 integer;
param s {i in 1..n} symbolic;
param BLOSSUM62 {aa,aa};
param m {i in 1..n-1,j in i+1..i+1,p in 1..length(s[i]),q in 1..length(s[j])} := BLOSSUM62[substr(s[i],p,1),substr(s[j],q,1)];
param ell := sum {i in 1..n} length(s[i]);
param M = max {i in 1..n} length(s[i]);

var x {i in 1..n,p in 1..length(s[i])} >= 1 integer;
var y {i in 1..n-1,j in i+1..i+1,p in 1..length(s[i]),q in 1..length(s[j])} binary;

maximize target: sum {i in 1..n-1,j in i+1..i+1,p in 1..length(s[i]),q in 1..length(s[j])} y[i,j,p,q]*m[i,j,p,q];

# creixent
subject to first {i in 1..n,p in 1..length(s[i])-1}: x[i,p] <= x[i,p+1]-1;

# mes petit que la llargada total de les sequencies
subject to second {i in 1..n,p in 1..length(s[i])}: x[i,p] <= ell;

# y[i,j,p,q] = 1 <=> x[i,p] = x[j,q]
subject to third {i in 1..n-1,j in i+1..i+1,p in 1..length(s[i]),q in 1..length(s[j])}: x[j,q] <= x[i,p] + M*(1-y[i,j,p,q]);
subject to fourth {i in 1..n-1,j in i+1..i+1,p in 1..length(s[i]),q in 1..length(s[j])}: x[i,p] <= x[j,q] + M*(1-y[i,j,p,q]);

#solve;

#display x;

data;

set aa := A R N D C Q E G H I L K M F P S T W Y V B Z X;
param BLOSSUM62 (tr):
   A  R  N  D  C  Q  E  G  H  I  L  K  M  F  P  S  T  W  Y  V  B  Z  X :=
A  4 -1 -2 -2  0 -1 -1  0 -2 -1 -1 -1 -1 -2 -1  1  0 -3 -2  0 -2 -1  0 
R -1  5  0 -2 -3  1  0 -2  0 -3 -2  2 -1 -3 -2 -1 -1 -3 -2 -3 -1  0 -1 
N -2  0  6  1 -3  0  0  0  1 -3 -3  0 -2 -3 -2  1  0 -4 -2 -3  3  0 -1 
D -2 -2  1  6 -3  0  2 -1 -1 -3 -4 -1 -3 -3 -1  0 -1 -4 -3 -3  4  1 -1 
C  0 -3 -3 -3  9 -3 -4 -3 -3 -1 -1 -3 -1 -2 -3 -1 -1 -2 -2 -1 -3 -3 -2 
Q -1  1  0  0 -3  5  2 -2  0 -3 -2  1  0 -3 -1  0 -1 -2 -1 -2  0  3 -1 
E -1  0  0  2 -4  2  5 -2  0 -3 -3  1 -2 -3 -1  0 -1 -3 -2 -2  1  4 -1 
G  0 -2  0 -1 -3 -2 -2  6 -2 -4 -4 -2 -3 -3 -2  0 -2 -2 -3 -3 -1 -2 -1 
H -2  0  1 -1 -3  0  0 -2  8 -3 -3 -1 -2 -1 -2 -1 -2 -2  2 -3  0  0 -1 
I -1 -3 -3 -3 -1 -3 -3 -4 -3  4  2 -3  1  0 -3 -2 -1 -3 -1  3 -3 -3 -1
L -1 -2 -3 -4 -1 -2 -3 -4 -3  2  4 -2  2  0 -3 -2 -1 -2 -1  1 -4 -3 -1
K -1  2  0 -1 -3  1  1 -2 -1 -3 -2  5 -1 -3 -1  0 -1 -3 -2 -2  0  1 -1
M -1 -1 -2 -3 -1  0 -2 -3 -2  1  2 -1  5  0 -2 -1 -1 -1 -1  1 -3 -1 -1 
F -2 -3 -3 -3 -2 -3 -3 -3 -1  0  0 -3  0  6 -4 -2 -2  1  3 -1 -3 -3 -1 
P -1 -2 -2 -1 -3 -1 -1 -2 -2 -3 -3 -1 -2 -4  7 -1 -1 -4 -3 -2 -2 -1 -2 
S  1 -1  1  0 -1  0  0  0 -1 -2 -2  0 -1 -2 -1  4  1 -3 -2 -2  0  0  0 
T  0 -1  0 -1 -1 -1 -1 -2 -2 -1 -1 -1 -1 -2 -1  1  5 -2 -2  0 -1 -1  0 
W -3 -3 -4 -4 -2 -2 -3 -2 -2 -3 -2 -3 -1  1 -4 -3 -2 11  2 -3 -4 -3 -2 
Y -2 -2 -2 -3 -2 -1 -2 -3  2 -1 -1 -2 -1  3 -3 -2 -2  2  7 -1 -3 -2 -1 
V  0 -3 -3 -3 -1 -2 -2 -3 -3  3  1 -2  1 -1 -2 -2  0 -3 -1  4 -3 -2 -1
B -2 -1  3  4 -3  0  1 -1  0 -3 -4  0 -3 -3 -2  0 -1 -4 -3 -3  4  1 -1
Z -1  0  0  1 -3  3  4 -2  0 -3 -3  1 -1 -3 -1  0 -1 -3 -2 -2  1  4 -1
X  0 -1 -1 -1 -2 -1 -1 -1 -1 -1 -1 -1 -1 -1 -2  0  0 -2 -1 -1 -1 -1 -1;

param n := 3;
param s :=
#1 "PKALIVYGST"
#2 "MPKALIVYGS"
#3 "MSKSLIVYGS";
1 "PKALIVYGSTTGNTEYTAETIARQLANAGYEVDSRDAASVEAGGLFEGFDLVLLGCSTWGDDSIELQDDFIPLFDSLEETGAQGRKVACFGCGDSSYEYFCGAVDAIEEKLKNLGAEIVQDGLRIDGDPRAARDDIVGWAHDVRGAI"
2 "MPKALIVYGSTTGNTEYTAETIARELADAGYEVDSRDAASVEAGGLFEGFDLVLLGCSTWGDDSIELQDDFIPLFDSLEETGAQGRKVACFGCGDSSYEYFCGAVDAIEEKLKNLGAEIVQDGLRIDGDPRAARDDIVGWAHDVRGAI"
3 "MSKSLIVYGSTTGNTETAAEYVAEAFENKEIDVELKNVTDVSVADLGNGYDIVLFGCSTWGEEEIELQDDFIPLYDSLENADLKGKKVSVFGCGDSDYTYFCGAVDAIEEKLEKMGAVVIGDSLKIDGDPERDEIVSWGSGIADKI"
;
#4 "MPKALIVYGSTTGNTEGVAEAIAKTLNSEGMETTVVNVADVTAPGLAEGYDVVLLGCSTWGDDEIELQEDFVPLYEDLDRAGLKDKKVGVFGCGDSSYTYFCGAVDVIEKKAEELGATLVASSLKIDGEPDSAEVLDWAREVLARV"
#5 "MSKVLIVFGSSTGNTESIAQKLEELIAAGGHEVTLLNAADASAENLADGYDAVLFGCSAWGMEDLEMQDDFLSLFEEFNRFGLAGRKVAAFASGDQEYEHFCGAVPAIEERAKELGATIIAEGLKMEGDASNDPEAVASFAEDVLKQL"
#6 "MKIVYWSGTGNTEKMAELIAKGIIESGKDVNTINVSDVNIDELLNEDILILGCSAMGDEVLEESEFEPFIEEISTKISGKKVALFGSYGWGDGKWMRDFEERMNGYGCVVVETPLIVQNEPDEAEQDCIEFGKKIANI"
#7 "MVEIVYWSGTGNTEAMANEIEAAVKAAGADVESVRFEDTNVDDVASKDVILLGCPAMGSEELEDSVVEPFFTDLAPKLKGKKVGLFGSYGWGSGEWMDAWKQRTEDTGATVIGTAIVNEMPDNAPECKELGEAAAKA"
#8 "KIGIFFSTSTGNTTEVADFIGKTLGAKADAPIDVDDVTDPQALKDYDLLFLGAPTWNTGADTERSGTSWDEFLYDKLPEVDMKDLPVAIFGLGDAEGYPDNFCDAIEEIHDCFAKQGAKPVGFSNPDDYDYEESKSVRDGKFLGLPLDMVNDQIPMEKRVAGWVEAVVSETGV"
#9 "SKKIGLFYGTQTGKTESVAEIIRDEFGNDVVTLHDVSQAEVTDLNDYQYLIIGCPTWNIGELQSDWEGLYSELDDVDFNGKLVAYFGTGDQIGYADNFQDAIGILEEKISQRGGKTVGYWSTDGYDFNDSKALRNGKFVGLALDEDNQSDLTDDRIKSWVAQLKSEFGL"
#10 "AKIGLFFGSNTGKTRKVAKSIKKRFDDETMSDALNVNRVSAEDFAQYQFLILGTPTLGEGELPGLSSDCENESWEEFLPKIEGLDFSGKTVALFGLGDQVGYPENYLDALGELYSFFKDRGAKIVGSWSTDGYEFESSEAVVDGKFVGLALDLDNQSGKTDERVAAWLAQIAPEFGLSL"
#11 "MATIGIFFGSDTGQTRKVAKLIHQKLDGIADAPLDVRRATREQFLSYPVLLLGTPTLGDGELPGVEAGSQYDSWQEFTNTLSEADLTGKTVALFGLGDQLNYSKNFVSAMRILYDLVIARGACVVGNWPREGYKFSFSAALLENNEFVGLPLDQENQYDLTEERIDSWLEKLKPAVL"
#12 "AITGIFFGSDTGNTENIAKMIQKQLGKDVADVHDIAKSSKEDLEAYDILLLGIPTWYYGEAQCDWDDFFPTLEEIDFNGKLVALFGCGDQEDYAEYFCDALGTIRDIIEPRGATIVGHWPTAGYHFEASKGLADDDHFVGLAIDEDRQPELTAERVEKWVKQISEELHLDEILNA"
#13 "MKISILYSSKTGKTERVAKLIEEGVKRSGNIEVKTMNLDAVDKKFLQESEGIIFGTPTYYANISWEMKKWIDESSEFNLEGKLGAAFSTANSIAGGSDIALLTILNHLMVKGMLVYSGGVAFGKPKTHLGYVHINEIQENEDENARIFGERIANKVKQIF"
#14 "ADKELKFLVVDDFSTMRRIVRNLLKELGFNNVEEAEDGVDALNKLQAGGYGFVISDWNMPNMDGLELLKTIRADGAMSALPVLMVTAEAKKENIIAAAQAGASGYVVKPFTAATLEEKLNKIFEKLGM";

end;
